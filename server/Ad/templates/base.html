<!DOCTYPE html>
<html lang="ru">
<head>
    {% block script-chat %}
  
    {% endblock %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AdNews{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    {% load static %}
    <style>
        /* Добавляем стили для звездного фона прямо в base.html */
        html {
            height: 100%;
        }
        
        .star-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .stars,
        .stars1,
        .stars2 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .stars {
            background: transparent url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBmaWxsPSIjZmZmIiBkPSJNMzIgMTZhMSAxIDAgMSAwIDAgMiAxIDEgMCAwIDAgMC0yem00NCAxMDhhMiAyIDAgMSAwIDAtNCAxIDEgMCAwIDAgMCA0eiIvPjwvc3ZnPg==') repeat;
            background-size: 256px 256px;
            animation: none;
        }
        
        .stars1 {
            background: transparent url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBmaWxsPSIjZmZmIiBkPSJNODIgMzRhMiAyIDAgMSAwIDAgNCAxIDEgMCAwIDAgMC00em0yODQgMTk4YTMgMyAwIDEgMCAwLTYgMyAzIDAgMCAwIDAgNnoiLz48L3N2Zz4=') repeat;
            background-size: 512px 512px;
            animation: none;
        }
        
        .stars2 {
            background: transparent url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAyNCIgaGVpZ2h0PSIxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yNDQgMTA2YTMgMyAwIDEgMCAwIDYgMyAzIDAgMCAwIDAtNnptNTU2IDQ2OGE0IDQgMCAxIDAgMC04IDQgNCAwIDAgMCAwIDh6Ii8+PC9zdmc+') repeat;
            background-size: 1024px 1024px;
            animation: none;
        }
        
        @keyframes animStar {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: -2560px 2560px;
            }
        }
        
        .shooting-star {
            position: absolute;
            width: 3px;
            height: 80px;
            background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
            border-top-left-radius: 50%;
            border-top-right-radius: 50%;
            animation: shootingStar 5s linear infinite;
            transform: rotate(45deg);
            opacity: 0;
        }
        
        @keyframes shootingStar {
            0% {
                transform: translate(calc(100vw * var(--x, 0)), calc(100vh * var(--y, 0))) rotate(45deg);
                opacity: 0;
                height: 5px;
            }
            1% {
                opacity: 1;
            }
            5% {
                opacity: 1;
                transform: translate(calc(100vw * var(--x, 0) - 100px), calc(100vh * var(--y, 0) + 100px)) rotate(45deg);
                height: 30px;
            }
            10% {
                opacity: 0;
                height: 80px;
                transform: translate(calc(100vw * var(--x, 0) - 200px), calc(100vh * var(--y, 0) + 200px)) rotate(45deg);
            }
            100% {
                opacity: 0;
                transform: translate(calc(100vw * var(--x, 0) - 200px), calc(100vh * var(--y, 0) + 200px)) rotate(45deg);
            }
        }
    
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #010105 0%, #150f38 100%);
            color: #231c5c;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 100%;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* Фоны для разных тем */
        body.theme-default {
            background: linear-gradient(to bottom, #010105 0%, #150f38 100%);
        }
        
        body.theme-cosmic {
            background: linear-gradient(to bottom, #010105 0%, #150f38 100%);
        }
        
        body.theme-rainy {
            background: linear-gradient(to bottom, #0a0a0a 0%, #232323 50%, #353535 100%);
            background-attachment: fixed;
            background-size: cover;
            position: relative;
        }

        body.theme-rainy::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300"><rect width="100%" height="100%" fill="none"/><path d="M30 40 L35 45 M60 30 L65 35 M80 70 L85 75 M120 60 L125 65 M150 90 L155 95 M190 30 L195 35 M220 70 L225 75 M260 90 L265 95" stroke="rgba(150, 150, 150, 0.1)" stroke-width="1"/></svg>');
            opacity: 0.3;
            pointer-events: none;
            z-index: -1;
        }

        .container {
            display: flex;
            flex-direction: column;
            flex: 1;
            padding: 0;
            gap: 0;
            box-sizing: border-box;
            width: 100%;
            margin: 0 auto;
            max-width: 100%;
            height: 100vh;
            min-height: 100vh;
            justify-content: space-between;
            overflow: hidden;
        }

        .header, .footer {
            width: calc(100% - 40px);
            background: rgba(255, 255, 255, 0.1);
            padding: 2px;
            border-radius: 10px;
            margin: 20px auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            position: relative;
            z-index: 10; /* Повышенный z-index для отображения поверх фоновых элементов */
            overflow: hidden;
        }

        body.rainy-theme .star-container,
        body.theme-rainy .star-container,
        body.rainy-theme .stars,
        body.theme-rainy .stars,
        body.rainy-theme .stars1,
        body.theme-rainy .stars1, 
        body.rainy-theme .stars2,
        body.theme-rainy .stars2,
        body.rainy-theme #shooting-stars-container,
        body.theme-rainy #shooting-stars-container {
            display: none !important;
        }

        /* Скрываем звёздный фон на всех страницах для серой темы */
        body.rainy-theme .enhanced-stars-container,
        body.theme-rainy .enhanced-stars-container {
            display: none !important;
        }

        /* Стили для дождливой темы в footer */
        body.rainy-theme .footer {
            background: rgba(60, 60, 60, 0.15);
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(80, 80, 80, 0.2);
        }

        .wrap {
            flex: 1;
            overflow: hidden;
            margin-right: 20px;
            position: relative;
        }

        .items-wrap {
            width: 100%;
            overflow: hidden;
            position: relative;
            mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
            padding: 15px 0;
        }

        .items {
            display: flex;
            white-space: nowrap;
            animation: scroll 4s linear infinite;
            will-change: transform;
            transform: translateZ(0);
        }

        .items-content {
            display: flex;
            flex-shrink: 0;
            gap: 20px;
            padding: 0 10px;
            animation: none;
        }

        .item {
            padding: 8px 20px;
            background: white;
            color: #231c5c;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            will-change: transform;
            transform: translateZ(0);
        }
        
        /* Стили для дождливой темы в элементах курса валют */
        body.rainy-theme .item {
            background: rgba(60, 60, 60, 0.3);
            color: #cccccc;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(80, 80, 80, 0.25);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .item:hover {
            transform: scale(1.1) translateY(-5px);
            background: #231c5c;
            color: white;
            box-shadow: 0 0 15px rgba(35, 28, 92, 0.3);
            z-index: 100;
            position: relative;
        }
        
        /* Стили для дождливой темы при наведении на элементы курса валют */
        body.rainy-theme .item:hover {
            background: rgba(70, 70, 70, 0.5);
            color: #ffffff;
            box-shadow: 0 0 15px rgba(70, 70, 70, 0.6);
            transform: scale(1.1) translateY(-5px);
            z-index: 100;
            position: relative;
        }

        @keyframes scroll {
            from { transform: translateX(0); }
            to { transform: translateX(-100%); }
        }

        .current-date {
            font-size: 1.2rem;
            color: white;
            padding: 5px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            min-width: 150px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-left: 20px;
        }
        
        /* Стили для дождливой темы в блоке с датой и временем */
        body.rainy-theme .current-date {
            background: rgba(60, 60, 60, 0.3);
            color: #cccccc;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(80, 80, 80, 0.25);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .current-time {
            font-size: 1.4rem;
            font-weight: bold;
        }

        .current-date-text {
            font-size: 1rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 2rem;
            margin-bottom: 40px;
            width: calc(100% - 40px);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 10;
            color: #231c5c;
        }
        
        /* Стили для header в дождливой теме */
        body.rainy-theme .header {
            background: rgba(40, 40, 40, 0.35);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(70, 70, 70, 0.25);
            backdrop-filter: blur(5px);
            color: #d8d8d8;
        }

        /* Добавляем стили для левой и правой секций заголовка */
        .header span {
            flex: 1;  /* Даем секциям одинаковую ширину */
            text-align: left;  /* Выравниваем текст по левому краю */
            color: inherit;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .header span:last-child {
            text-align: right;  /* Выравниваем RTUMIREA по правому краю */
        }

        .rtumirea-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            flex: 1;
            gap: 10px;
        }
        
        /* Стили для блока времени в хедере */
        .rtumirea-container .current-date {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            margin-right: 20px;
            background: rgba(35, 28, 92, 0.1);
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid rgba(35, 28, 92, 0.2);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            min-width: 120px;
            transition: all 0.3s ease;
        }
        
        body.theme-default .rtumirea-container .current-date {
            background: rgba(35, 28, 92, 0.15);
            color: #231c5c;
            border: 1px solid rgba(35, 28, 92, 0.3);
        }
        
        body.theme-cosmic .rtumirea-container .current-date {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        body.theme-rainy .rtumirea-container .current-date {
            background: rgba(60, 60, 60, 0.3);
            color: #cccccc;
            border: 1px solid rgba(80, 80, 80, 0.3);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .rtumirea-container .current-time {
            font-size: 1.3rem;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .rtumirea-container .current-date-text {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .theme-toggle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #3b1b78, #1a237e); /* Дефолтный стиль */
            color: white;
        }
        
        body.theme-default .theme-toggle {
            background: linear-gradient(135deg, #283593, #1a237e);
        }
        
        body.theme-cosmic .theme-toggle {
            background: linear-gradient(135deg, #3b1b78, #1a237e);
        }
        
        body.theme-rainy .theme-toggle {
            background: linear-gradient(135deg, #191919, #2a2a2a);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .nav-menu {
            flex: 2;  /* Даем навигационному меню больше пространства */
            display: flex;
            justify-content: center;  /* Центрируем меню */
            gap: 20px;
        }

        .nav-link {
            color: inherit;
            text-decoration: none;
            font-size: 1.2rem;
            padding: 5px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover {
            background-color: rgba(35, 28, 92, 0.1);
        }
        
        /* Стили для навигации в дождливой теме */
        body.rainy-theme .nav-link {
            color: #d8d8d8;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        body.rainy-theme .nav-link:hover {
            background-color: rgba(60, 60, 60, 0.4);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            color: #ffffff;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 0;
            margin-top: 10px;
            position: relative;
            box-sizing: border-box;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
            max-height: none;
            min-height: 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .content::-webkit-scrollbar {
            display: none;
            width: 0;
        }

        .auth-container {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-group label {
            font-weight: bold;
        }

        .form-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-submit {
            padding: 10px 20px;
            background-color: #231c5c;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .form-submit:hover {
            background-color: #1a1461;
        }

        .messages {
            margin-bottom: 20px;
        }

        .message {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .message-error {
            background-color: #ffebee;
            color: #c62828;
        }

        .message-success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
    </style>
    {% block style %}{% endblock %}
    <style>
        /* Стили для всплывающих сообщений */
        .currency-tooltip {
            position: absolute;
            width: auto;
            max-width: 250px;
            background-color: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
            line-height: 1.4;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
            pointer-events: none;
            will-change: transform, left, top;
            transform: translateY(10px);
        }

        /* Стили для тултипа в дождливой теме */
        body.rainy-theme .currency-tooltip {
            background-color: rgba(40, 40, 40, 0.9);
            color: #d8d8d8;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(70, 70, 70, 0.3);
            backdrop-filter: blur(5px);
        }

        .currency-tooltip:after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(0, 0, 0, 0.85);
        }

        /* Стрелка для тултипа в дождливой теме */
        body.rainy-theme .currency-tooltip:after {
            border-top-color: rgba(40, 40, 40, 0.9);
        }

        .currency-tooltip.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .item {
            animation: none;
        }

        .item.clicked {
            animation: jumpAnimation 0.5s cubic-bezier(0.36, 0, 0.66, -0.56) forwards;
        }

        @keyframes jumpAnimation {
            0% { 
                transform: translateY(0) scale(1);
            }
            25% { 
                transform: translateY(-8px) scale(1.05);
            }
            50% { 
                transform: translateY(-3px) scale(1.03);
            }
            75% { 
                transform: translateY(-5px) scale(1.04);
            }
            100% { 
                transform: translateY(0) scale(1);
            }
        }

        .cbr-tooltip {
            position: absolute;
            background: rgba(35, 28, 92, 0.95);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 1.1rem;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
            text-align: center;
            pointer-events: none;
            left: 50%;
            top: 120%;
            transform: translateX(-50%);
        }
        
        /* Стили для cbr-tooltip в дождливом стиле */
        body.rainy-theme .cbr-tooltip {
            background: rgba(40, 40, 40, 0.9);
            color: #d8d8d8;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(70, 70, 70, 0.3);
            backdrop-filter: blur(5px);
        }

        .cbr-tooltip.show {
            opacity: 1;
            transform: translate(-50%, 0);
        }
        
        /* Стили для инфо-заголовка (как на изображении) */
        .currency-info-header {
            position: fixed;
            background: rgba(35, 28, 92, 0.95);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1rem;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        /* Стили для инфо-заголовка в дождливом стиле */
        body.rainy-theme .currency-info-header {
            background: rgba(40, 40, 40, 0.9);
            color: #d8d8d8;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(70, 70, 70, 0.3);
            backdrop-filter: blur(7px);
        }
        
        .currency-info-header.show {
            opacity: 1;
        }
        
        .currency-info-header .icon {
            font-size: 1.2rem;
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .qr-section {
            position: relative;
            cursor: pointer;
            padding: 5px;
            background: transparent;
            border-radius: 4px;
            transition: all 0.3s ease;
            margin-right: 70px;
            transform: scale(1.0);
            margin-top: 40px;  
        }
        
        .qr-section:hover {
            background: transparent;
            transform: scale(1.0);
        }

        .qr-section span {
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
        }

        /* Новые стили для анимации фона с пылинками для серой темы */
        body.theme-rainy .dust-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        body.theme-rainy .dust-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body.theme-rainy .dust-particles li {
            position: absolute;
            display: block;
            list-style: none;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(200, 200, 200, 0.4) 0%, rgba(180, 180, 180, 0.1) 70%);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.15);
            animation: float-dust 20s ease-in-out infinite;
            bottom: -20px;
            filter: blur(0.8px);
        }

        body.theme-rainy .dust-particles li:nth-child(1) {
            left: 15%;
            width: 12px;
            height: 12px;
            animation-delay: 0s;
            animation-duration: 15s;
        }

        body.theme-rainy .dust-particles li:nth-child(2) {
            left: 35%;
            width: 8px;
            height: 8px;
            animation-delay: 2s;
            animation-duration: 18s;
        }

        body.theme-rainy .dust-particles li:nth-child(3) {
            left: 55%;
            width: 10px;
            height: 10px;
            animation-delay: 4s;
            animation-duration: 20s;
        }

        body.theme-rainy .dust-particles li:nth-child(4) {
            left: 75%;
            width: 15px;
            height: 15px;
            animation-delay: 1s;
            animation-duration: 22s;
        }

        body.theme-rainy .dust-particles li:nth-child(5) {
            left: 25%;
            width: 9px;
            height: 9px;
            animation-delay: 7s;
            animation-duration: 19s;
        }

        body.theme-rainy .dust-particles li:nth-child(6) {
            left: 50%;
            width: 14px;
            height: 14px;
            animation-delay: 3s;
            animation-duration: 17s;
        }

        body.theme-rainy .dust-particles li:nth-child(7) {
            left: 65%;
            width: 11px;
            height: 11px;
            animation-delay: 6s;
            animation-duration: 23s;
        }

        body.theme-rainy .dust-particles li:nth-child(8) {
            left: 30%;
            width: 13px;
            height: 13px;
            animation-delay: 5s;
            animation-duration: 21s;
        }

        body.theme-rainy .dust-particles li:nth-child(9) {
            left: 80%;
            width: 10px;
            height: 10px;
            animation-delay: 4s;
            animation-duration: 16s;
        }

        body.theme-rainy .dust-particles li:nth-child(10) {
            left: 45%;
            width: 16px;
            height: 16px;
            animation-delay: 2s;
            animation-duration: 24s;
        }

        body.theme-rainy .dust-particles li:nth-child(11) {
            left: 60%;
            width: 9px;
            height: 9px;
            animation-delay: 8s;
            animation-duration: 19s;
        }

        body.theme-rainy .dust-particles li:nth-child(12) {
            left: 20%;
            width: 12px;
            height: 12px;
            animation-delay: 5s;
            animation-duration: 22s;
        }

        body.theme-rainy .dust-particles li:nth-child(13) {
            left: 70%;
            width: 14px;
            height: 14px;
            animation-delay: 3s;
            animation-duration: 18s;
        }

        body.theme-rainy .dust-particles li:nth-child(14) {
            left: 40%;
            width: 11px;
            height: 11px;
            animation-delay: 1s;
            animation-duration: 20s;
        }

        body.theme-rainy .dust-particles li:nth-child(15) {
            left: 85%;
            width: 13px;
            height: 13px;
            animation-delay: 4s;
            animation-duration: 21s;
        }

        @keyframes float-dust {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0;
            }
            5% {
                opacity: 0.4;
            }
            30% {
                transform: translateY(-200px) translateX(15px) rotate(140deg);
                opacity: 0.5;
            }
            50% {
                transform: translateY(-400px) translateX(-15px) rotate(240deg);
                opacity: 0.4;
            }
            75% {
                transform: translateY(-700px) translateX(20px) rotate(340deg);
                opacity: 0.2;
            }
            100% {
                transform: translateY(-1000px) translateX(-10px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Звездный фон -->
    <div class="star-container">
        <div id="shooting-stars-container"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <span>Орбита Новостей</span>
            <div class="nav-menu">
                <a href="{% url 'main' %}" class="nav-link">Главная</a>
                <a href="{% url 'currency_charts' %}" class="nav-link">Курсы валют</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'profile' %}" class="nav-link">Личный кабинет</a>
                    <a href="{% url 'logout' %}" class="nav-link">Выход</a>
                {% else %}
                    <a href="{% url 'login' %}" class="nav-link">Вход</a>
                    <a href="{% url 'register' %}" class="nav-link">Регистрация</a>
                {% endif %}
            </div>
            <div class="rtumirea-container">
                <span>RTUMIREA</span>
                <div class="current-date" id="header-time">-- : --</div>
                <div class="theme-toggle" id="theme-toggle">
                    <i>⚪️</i>
                </div>
            </div>
        </div>

        <div class="content">
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="message {% if message.tags %}message-{{ message.tags }}{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            {% block content %}{% endblock %}
            
            <!-- Анимация пылинок для серой темы -->
            <div class="dust-container" style="display: none;">
                <ul class="dust-particles">
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
        </div>

        {% if request.path == '/main/' or request.path == '/currency/' %}
        <div class="footer">
            <div class="wrap">
                <div class="items-wrap">
                    <div class="items" id="currency-items">
                        <div class="items-content">
                            {% for currency in currency_rates %}
                                <div class="item" data-currency="{{ currency.currency_name }}">
                                    {% if currency.currency_name == "BTC" or currency.currency_name == "ETH" %}
                                        {{ currency.currency_name }} {{ currency.rate }}$
                                    {% else %}
                                        {{ currency.symbol }} {{ currency.rate }}₽
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        <div class="items-content">
                            {% for currency in currency_rates %}
                                <div class="item" data-currency="{{ currency.currency_name }}">
                                    {% if currency.currency_name == "BTC" or currency.currency_name == "ETH" %}
                                        {{ currency.currency_name }} {{ currency.rate }}$
                                    {% else %}
                                        {{ currency.symbol }} {{ currency.rate }}₽
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        <div class="items-content">
                            {% for currency in currency_rates %}
                                <div class="item" data-currency="{{ currency.currency_name }}">
                                    {% if currency.currency_name == "BTC" or currency.currency_name == "ETH" %}
                                        {{ currency.currency_name }} {{ currency.rate }}$
                                    {% else %}
                                        {{ currency.symbol }} {{ currency.rate }}₽
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        <div class="items-content">
                            {% for currency in currency_rates %}
                                <div class="item" data-currency="{{ currency.currency_name }}">
                                    {% if currency.currency_name == "BTC" or currency.currency_name == "ETH" %}
                                        {{ currency.currency_name }} {{ currency.rate }}$
                                    {% else %}
                                        {{ currency.symbol }} {{ currency.rate }}₽
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        <div class="items-content">
                            {% for currency in currency_rates %}
                                <div class="item" data-currency="{{ currency.currency_name }}">
                                    {% if currency.currency_name == "BTC" or currency.currency_name == "ETH" %}
                                        {{ currency.currency_name }} {{ currency.rate }}$
                                    {% else %}
                                        {{ currency.symbol }} {{ currency.rate }}₽
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        // Инициализация часов в хедере - работает на всех страницах
        (function initHeaderTime() {
            function updateHeaderTime() {
                const now = new Date();
                const time = now.toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                
                const date = now.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                
                // Обновляем только элемент времени в хедере
                const headerTimeElement = document.getElementById('header-time');
                if (headerTimeElement) {
                    headerTimeElement.innerHTML = `
                        <div class="current-time">${time}</div>
                        <div class="current-date-text">${date}</div>
                    `;
                }
            }
            
            // Обновляем время в хедере сразу
            updateHeaderTime();
            
            // Обновляем каждую секунду
            setInterval(updateHeaderTime, 1000);
        })();
        
        document.addEventListener('DOMContentLoaded', () => {
            const items = document.querySelector('.items');
            let isReversed = false; // Флаг направления движения
            
            // Обновляем курсы валют при загрузке страницы
            updateFooterCurrencyRates();
            
            // Устанавливаем интервал обновления каждые 15 минут
            setInterval(updateFooterCurrencyRates, 15 * 60 * 1000);
            
            function setupScroll() {
                const itemsContent = document.querySelector('.items-content');
                const scrollWidth = itemsContent.offsetWidth;
                const duration = Math.max(scrollWidth / 200, 2) * 5;
                
                // Плавно останавливаем текущую анимацию
                items.style.animation = 'none';
                items.offsetHeight;
                
                // Меняем направление движения при достижении конца
                const animationDirection = isReversed ? 'reverse' : 'normal';
                
                // Запускаем новую анимацию
                requestAnimationFrame(() => {
                    items.style.animation = `scroll ${duration}s linear forwards ${animationDirection}`;
                });

                // Устанавливаем таймаут для смены направления в конце анимации
                clearTimeout(window.scrollTimeout);
                window.scrollTimeout = setTimeout(() => {
                    if (!document.hidden) {
                        isReversed = !isReversed; // Меняем направление
                        setupScroll(); // Перезапускаем с новым направлением
                    }
                }, duration * 1000);
            }

            // Настройка начальной анимации
            setupScroll();

            // Перенастройка при изменении размера окна с debounce
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(setupScroll, 150);
            });

            // При уходе со страницы очищаем интервал
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    clearTimeout(window.scrollTimeout);
                } else {
                    setupScroll();
                }
            });

            // Очищаем старый таймаут при размонтировании
            window.addEventListener('beforeunload', () => {
                clearTimeout(window.scrollTimeout);
            });
            
            // Обновление времени для элементов в футере и других местах
            function updateOtherTimeElements() {
                const now = new Date();
                const time = now.toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                const date = now.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                
                // Обновляем контейнеры с датой (кроме элемента в хедере)
                const dateContainers = document.querySelectorAll('.current-date:not(#header-time)');
                dateContainers.forEach(container => {
                    container.innerHTML = `
                        <div class="current-time">${time}</div>
                        <div class="current-date-text">${date}</div>
                    `;
                });
            }
            
            // Обновляем время в других элементах
            updateOtherTimeElements();
            setInterval(updateOtherTimeElements, 1000);
        });

        // Добавляем скрипт для создания падающих звезд
        document.addEventListener('DOMContentLoaded', () => {
            const shootingStarsContainer = document.getElementById('shooting-stars-container');
            const numberOfStars = 10;
            
            // Создаем падающие звезды
            for (let i = 0; i < numberOfStars; i++) {
                createShootingStar(shootingStarsContainer, i);
            }
            
            function createShootingStar(container, index) {
                const star = document.createElement('div');
                star.className = 'shooting-star';
                
                // Устанавливаем случайную начальную позицию
                const xPos = Math.random();
                const yPos = Math.random() * 0.5; // Только в верхней половине экрана
                
                star.style.setProperty('--x', xPos);
                star.style.setProperty('--y', yPos);
                
                // Устанавливаем случайную задержку для начала анимации
                star.style.animationDelay = `${Math.random() * 20}s`;
                
                container.appendChild(star);
            }
        });

        // Обновляем объект currencyFacts и увеличиваем время показа тултипа
        const currencyFacts = {
            'USD': [
                '💵 Первый доллар США был отчеканен в 1794 году',
                '🏛️ Федеральная резервная система США была создана в 1913 году',
                '🌍 Доллар стал мировой резервной валютой после Бреттон-Вудской конференции 1944 года',
                '🏦 85% всех международных транзакций проводятся в долларах',
                '📈 Доллар является официальной валютой в более чем 10 странах мира',
                '💱 Символ $ происходит от испанского песо, где использовались буквы PS',
                '🏆 Самая крупная купюра доллара - 100 000$, использовалась только между банками',
                '🔍 На однодолларовой купюре есть 7 различных номеров серии',
                '📜 Срок службы бумажной долларовой купюры составляет около 18 месяцев',
                '🎨 Зеленый цвет долларов был выбран из-за его устойчивости к химическому и физическому воздействию',
                '🏰 Форт Нокс хранит золотой запас США стоимостью более 290 миллиардов долларов',
                '🖨️ Ежедневно печатается около 38 миллионов долларовых банкнот'
            ],
            'EUR': [
                '🇪🇺 Евро был введен в безналичное обращение 1 января 1999 года',
                '💶 Наличные евро появились в обращении 1 января 2002 года',
                '🌍 Евро является официальной валютой в 20 странах Европейского союза',
                '🏦 Европейский центральный банк находится во Франкфурте-на-Майне',
                '🎨 Дизайн банкнот евро символизирует архитектурные стили разных эпох',
                '🔒 Евро имеет более 8 степеней защиты от подделки',
                '💱 Евро - вторая по популярности резервная валюта в мире после доллара',
                '🏛️ На купюрах евро изображены вымышленные архитектурные сооружения',
                '📊 Около 30% мировых валютных резервов хранится в евро',
                '🌐 Евро используется в 150 миллионах платежей ежедневно',
                '🏆 Самая крупная купюра евро - 500€, но её выпуск прекращен в 2019 году',
                '📈 40% мирового долга номинировано в евро'
            ],
            'CNY': [
                '🇨🇳 Юань стал официальной валютой Китая в 1949 году',
                '📈 Китай является крупнейшим экспортером в мире с 2009 года',
                '🏦 Народный банк Китая - один из крупнейших держателей золота в мире',
                '💹 Юань входит в корзину специальных прав заимствования МВФ с 2016 года',
                '🌐 Китай создал систему CIPS как альтернативу SWIFT для международных расчетов',
                '📱 Китай лидирует в развитии цифровой валюты центрального банка',
                '🏗️ Юань активно используется в проекте "Один пояс - один путь"',
                '💰 Китай имеет крупнейшие в мире валютные резервы',
                '🏦 С 2005 года курс юаня привязан к корзине валют',
                '📊 Юань входит в топ-5 наиболее используемых валют в международных расчетах',
                '🏛️ История китайских бумажных денег насчитывает более 1000 лет',
                '🌍 Юань становится все более популярной валютой в международной торговле'
            ],
            'BTC': [
                '💻 Биткоин был создан в 2009 году человеком под псевдонимом Сатоши Накамото',
                '🔒 Максимальное количество биткоинов ограничено 21 миллионом',
                '📈 Первая транзакция биткоина: покупка двух пицц за 10,000 BTC',
                '⛏️ Каждые 10 минут создается новый блок в блокчейне биткоина',
                '🏦 Более 100 стран признают биткоин легальным платежным средством',
                '💽 Размер блокчейна биткоина превышает 400 гигабайт',
                '🔐 Около 20% всех биткоинов считаются утерянными навсегда',
                '⚡ Lightning Network позволяет проводить миллионы транзакций в секунду',
                '🌍 Биткоин легален как платежное средство в Сальвадоре и ЦАР',
                '📊 Первый биткоин-ETF был запущен в 2021 году',
                '🏭 На майнинг биткоина тратится больше электроэнергии, чем потребляют некоторые страны',
                '💱 Биткоин торгуется на более чем 400 биржах по всему миру'
            ],
            'ETH': [
                '🔧 Ethereum был создан Виталиком Бутериным в 2015 году',
                '🌐 Платформа поддерживает создание смарт-контрактов и децентрализованных приложений',
                '🌐 На Ethereum работает более 80% всех DeFi проектов',
                '🔄 В 2022 году Ethereum перешел на proof-of-stake, снизив энергопотребление на 99.95%',
                '📊 Ежедневно в сети Ethereum проводится более миллиона транзакций',
                '🎨 Большинство NFT создается на блокчейне Ethereum',
                '💰 Объем заблокированных средств в DeFi на Ethereum превышает 50 миллиардов долларов',
                '🏗️ Ethereum 2.0 способен обрабатывать до 100,000 транзакций в секунду',
                '🔐 Более 500,000 валидаторов обеспечивают безопасность сети',
                '📱 Существует более 3000 децентрализованных приложений на Ethereum',
                '🌍 Ethereum поддерживается крупнейшими технологическими компаниями',
                '💻 Язык программирования Solidity был создан специально для Ethereum'
            ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            const items = document.querySelectorAll('.item');
            let tooltip = document.createElement('div');
            tooltip.className = 'currency-tooltip';
            document.body.appendChild(tooltip);
            
            // Переменная для хранения таймера подсказки
            let tooltipTimer = null;
            // Переменная для хранения активного элемента
            let activeItem = null;
            // Таймер для обновления позиции подсказки
            let positionUpdateTimer = null;

            // Функция для обновления позиции подсказки
            function updateTooltipPosition() {
                if (!activeItem || !tooltip.classList.contains('show')) {
                    if (positionUpdateTimer) {
                        cancelAnimationFrame(positionUpdateTimer);
                        positionUpdateTimer = null;
                    }
                    return;
                }
                
                const rect = activeItem.getBoundingClientRect();
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                tooltip.style.left = Math.max(10, Math.min(
                    rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2),
                    window.innerWidth - tooltip.offsetWidth - 10
                )) + 'px';
                tooltip.style.top = Math.max(10, rect.top + scrollTop - tooltip.offsetHeight - 10) + 'px';
                
                // Запускаем следующее обновление позиции
                positionUpdateTimer = requestAnimationFrame(updateTooltipPosition);
            }

            items.forEach(item => {
                item.addEventListener('click', function(e) {
                    // Удаляем активный класс и класс анимации у всех элементов
                    items.forEach(i => {
                        i.classList.remove('active', 'clicked');
                    });
                    
                    // Добавляем классы текущему элементу
                    this.classList.add('active');
                    this.classList.add('clicked');
                    
                    // Сохраняем активный элемент
                    activeItem = this;
                    
                    // Удаляем класс анимации после её завершения
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 600);

                    // Определяем валюту из текста элемента
                    const currencyText = this.textContent.trim();
                    
                    let currency = null;

                    // Определяем валюту на основе формата отображения
                    if (currencyText.includes('BTC')) currency = 'BTC';
                    else if (currencyText.includes('ETH')) currency = 'ETH';
                    else if (currencyText.includes('$')) currency = 'USD';
                    else if (currencyText.includes('€')) currency = 'EUR';
                    else if (currencyText.includes('¥')) currency = 'CNY';
                    
                    if (currency) {
                        const facts = currencyFacts[currency];
                        const randomFact = facts[Math.floor(Math.random() * facts.length)];
                        
                        tooltip.textContent = randomFact;
                        tooltip.classList.add('show');
                        
                        // Начинаем отслеживать позицию элемента
                        if (!positionUpdateTimer) {
                            updateTooltipPosition();
                        }
                        
                        // Очищаем предыдущий таймер, если он существует
                        if (tooltipTimer) {
                            clearTimeout(tooltipTimer);
                        }
                        
                        // Скрываем тултип через 5 секунд и сохраняем ссылку на таймер
                        tooltipTimer = setTimeout(() => {
                            tooltip.classList.remove('show');
                            tooltipTimer = null;
                            activeItem = null;
                            
                            // Останавливаем отслеживание позиции
                            if (positionUpdateTimer) {
                                cancelAnimationFrame(positionUpdateTimer);
                                positionUpdateTimer = null;
                            }
                        }, 5000);
                    }
                });

                // Обновляем обработчики наведения
                item.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('clicked')) {
                        this.style.transform = 'translateY(-2px) scale(1.05)';
                    }
                });

                item.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('clicked')) {
                        this.style.transform = 'translateY(0) scale(1)';
                        this.classList.remove('active');
                    }
                });
            });

            // Скрываем тултип при клике вне элементов
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.item')) {
                    tooltip.classList.remove('show');
                    items.forEach(item => {
                        item.classList.remove('active', 'clicked');
                        item.style.transform = 'translateY(0) scale(1)';
                    });
                    
                    // Очищаем таймер подсказки
                    if (tooltipTimer) {
                        clearTimeout(tooltipTimer);
                        tooltipTimer = null;
                    }
                    
                    // Сбрасываем активный элемент
                    activeItem = null;
                    
                    // Останавливаем отслеживание позиции
                    if (positionUpdateTimer) {
                        cancelAnimationFrame(positionUpdateTimer);
                        positionUpdateTimer = null;
                    }
                }
            });
        });

        // Обработчик события для переключения темы при клике на иконку в хедере
        document.addEventListener('DOMContentLoaded', function() {
            // Создаем пользовательское событие для оповещения о смене темы
            const themeChangeEvent = new CustomEvent('themeChanged', {
                bubbles: true,
                detail: { theme: '' }
            });
            
            // Функция применения темы, которую можно вызвать из любого места
            window.applyTheme = function(theme) {
                console.log('Global applyTheme вызван с темой:', theme);
                
                // Проверяем валидность темы
                if (!['default', 'cosmic', 'rainy'].includes(theme)) {
                    console.error('Неправильный аргумент темы:', theme);
                    theme = 'default';
                }
                
                // Сохраняем выбранную тему в localStorage
                localStorage.setItem('theme', theme);
                
                // Применяем тему к body
                document.body.className = '';  // Очищаем все классы
                document.body.classList.add('theme-' + theme);
                
                // Для обратной совместимости с main.html
                if (theme === 'cosmic') {
                    document.body.classList.add('cosmic-theme');
                } else if (theme === 'rainy') {
                    document.body.classList.add('rainy-theme');
                }
                
                // Скрываем или показываем звёздное небо в зависимости от темы
                try {
                    const starContainer = document.querySelector('.star-container');
                    const rainyBackground = document.getElementById('rainy-background');
                    const dustContainer = document.querySelector('.dust-container');
                    
                    // Управляем видимостью в зависимости от темы
                    if (theme === 'rainy') {
                        // Для серой темы - скрываем звёздный фон
                        if (starContainer) starContainer.style.display = 'none';
                        if (rainyBackground) rainyBackground.style.display = 'block';
                        // Показываем пылинки 
                        if (dustContainer) dustContainer.style.display = 'block';
                    } else {
                        // Для космических тем - показываем звёздный фон
                        if (starContainer) starContainer.style.display = 'block';
                        if (rainyBackground) rainyBackground.style.display = 'none';
                        // Скрываем пылинки
                        if (dustContainer) dustContainer.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Ошибка при управлении видимостью фона:', error);
                }
                
                // Обновляем детали события
                themeChangeEvent.detail.theme = theme;
                
                // Генерируем событие смены темы
                document.dispatchEvent(themeChangeEvent);
                
                console.log('Тема успешно применена:', theme);
            };
            
            // Найти кнопку переключения темы в хедере
            const headerThemeToggle = document.querySelector('.theme-toggle');
            
            // Добавить обработчик клика, если элемент найден
            if (headerThemeToggle) {
                headerThemeToggle.addEventListener('click', function() {
                    // Переключение между темами
                    const currentTheme = localStorage.getItem('theme') || 'default';
                    let nextTheme;
                    
                    // Определить следующую тему
                    if (currentTheme === 'default') {
                        nextTheme = 'cosmic';
                    } else if (currentTheme === 'cosmic') {
                        nextTheme = 'rainy';
                    } else {
                        nextTheme = 'default';
                    }
                    
                    // Применяем следующую тему через общую функцию
                    window.applyTheme(nextTheme);
                });
            }
            
            // Слушатель события для элементов, загруженных динамически
            document.addEventListener('themeChanged', function(e) {
                console.log('Событие смены темы получено, новая тема:', e.detail.theme);
            });
            
            // Применяем сохраненную тему при загрузке
            const savedTheme = localStorage.getItem('theme') || 'default';
            window.applyTheme(savedTheme);
            
            // Также добавляем слушатель события хранилища для синхронизации между вкладками
            window.addEventListener('storage', function(e) {
                if (e.key === 'theme') {
                    console.log('Тема изменена в другой вкладке:', e.newValue);
                    window.applyTheme(e.newValue);
                }
            });
        });

        // Добавляем код для обработки переключения темы
        document.addEventListener('DOMContentLoaded', function() {
            // Проверяем, используется ли серая тема при загрузке
            if (document.body.classList.contains('rainy-theme') || 
                document.body.classList.contains('theme-rainy')) {
                
                // Скрываем звёздный фон
                const starContainer = document.querySelector('.star-container');
                if (starContainer) starContainer.style.display = 'none';
                
                // Показываем дождливый фон
                const rainyBackground = document.getElementById('rainy-background');
                if (rainyBackground) rainyBackground.style.display = 'block';
                
                // Показываем пылинки
                const dustContainer = document.querySelector('.dust-container');
                if (dustContainer) {
                    dustContainer.style.display = 'block';
                }
            }
            
            // Элементы для смены темы
            const dustContainer = document.querySelector('.dust-container');
            const themeToggle = document.querySelector('.theme-toggle');
            
            // Функция для обработки смены темы
            function handleThemeChange() {
                // Проверяем, используется ли серая тема
                if (document.body.classList.contains('theme-rainy')) {
                    // Показываем пылинки
                    if (dustContainer) {
                        dustContainer.style.display = 'block';
                    }
                } else {
                    // Скрываем пылинки
                    if (dustContainer) {
                        dustContainer.style.display = 'none';
                    }
                }
            }
            
            // Инициализация при загрузке страницы
            handleThemeChange();
            
            // Проверяем наличие элементов с классом theme-option 
            const themeOptions = document.querySelectorAll('.theme-option');
            if (themeOptions.length > 0) {
                themeOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        // Когда тема меняется, проверяем состояние
                        setTimeout(handleThemeChange, 100);
                    });
                });
            }
            
            // Если есть кнопка переключения темы, добавляем обработчик
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    // Когда тема меняется, проверяем состояние
                    setTimeout(handleThemeChange, 100);
                });
            }
        });

        // Функция для получения CSRF-токена из cookie
        function getCsrfToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Функция для обновления курсов валют в футере
        function updateFooterCurrencyRates() {
            fetch('/api/currency-history/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCsrfToken(),
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    currency_code: 'USD',
                    period: 'day'
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'success' && data.data.length > 0) {
                    // Получаем последнее значение USD
                    const usdLatestRate = data.data[data.data.length - 1].value;

                    document.querySelectorAll('.item[data-currency="USD"]').forEach(item => {
                        item.textContent = `$ ${usdLatestRate.toLocaleString('ru-RU')}₽`;
                    });
                    
                    // Делаем то же самое для других валют
                    const currencies = ['EUR', 'CNY', 'BTC', 'ETH'];
                    
                    currencies.forEach(currency => {
                        fetch('/api/currency-history/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCsrfToken(),
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify({
                                currency_code: currency,
                                period: 'day'
                            })
                        })
                        .then(response => response.json())
                        .then(currData => {
                            if (currData.status === 'success' && currData.data.length > 0) {
                                const latestRate = currData.data[currData.data.length - 1].value;
                                const symbols = {
                                    'EUR': '€',
                                    'CNY': '¥',
                                    'BTC': 'BTC',
                                    'ETH': 'ETH'
                                };
                                
                                document.querySelectorAll(`.item[data-currency="${currency}"]`).forEach(item => {
                                    if (currency === 'BTC' || currency === 'ETH') {
                                        item.textContent = `${currency} ${latestRate.toLocaleString('ru-RU')}$`;
                                    } else {
                                        item.textContent = `${symbols[currency]} ${latestRate.toLocaleString('ru-RU')}₽`;
                                    }
                                });
                            }
                        })
                        .catch(error => console.error(`Ошибка при получении данных для ${currency}:`, error));
                    });
                }
            })
            .catch(error => console.error('Ошибка при обновлении курсов валют в футере:', error));
        }
    </script>
    {% block script %}{% endblock %}
</body>
</html> 
